<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin Dashboard - Online Attendance</title>
  <link rel="stylesheet" href="css/style.css" />
  <script src="js/auth.js"></script>
</head>
<body>
  <header class="app-header">
    <div class="app-header-inner">
      <div class="brand">
        <div class="brand-icon">A</div>
        <div class="brand-text">
          <span class="brand-title">Admin Dashboard</span>
          <span class="brand-subtitle">System management &amp; configuration</span>
        </div>
      </div>
      <!-- Admin navbar: management-focused, no attendance/session options -->
      <nav class="nav-primary" aria-label="Admin navigation">
        <a href="admin-dashboard.html" class="nav-pill active">
          <span class="nav-pill-icon">ğŸ“Š</span>
          <span class="nav-pill-label">Dashboard</span>
        </a>
        <a href="class-management.html" class="nav-pill">
          <span class="nav-pill-icon">ğŸ«</span>
          <span class="nav-pill-label">Classes</span>
        </a>
        <a href="teachers.html" class="nav-pill">
          <span class="nav-pill-icon">ğŸ‘©â€ğŸ«</span>
          <span class="nav-pill-label">Teachers</span>
        </a>
        <a href="students.html" class="nav-pill">
          <span class="nav-pill-icon">ğŸ‘¨â€ğŸ“</span>
          <span class="nav-pill-label">Students</span>
        </a>
        <a href="reports.html" class="nav-pill">
          <span class="nav-pill-icon">ğŸ“‘</span>
          <span class="nav-pill-label">Reports</span>
        </a>
        <a href="settings.html" class="nav-pill">
          <span class="nav-pill-icon">âš™ï¸</span>
          <span class="nav-pill-label">Settings</span>
        </a>
        <button type="button" id="adminLogout" class="nav-pill">
          <span class="nav-pill-icon">ğŸšª</span>
          <span class="nav-pill-label">Logout</span>
        </button>
      </nav>
    </div>
  </header>

  <main class="admin-main">
    <!-- System Owner Overview -->
    <section class="card admin-overview-card glass">
      <div class="admin-overview-header">
        <div>
          <h2 class="admin-title">System Owner Overview</h2>
          <p id="adminWelcome" class="admin-subtitle">Welcome, admin (Admin)</p>
        </div>
        <span class="admin-chip">Full System Owner</span>
      </div>
      <ul class="admin-overview-list">
        <li>Configure classes, teachers, and students across the entire institute.</li>
        <li>Monitor attendance performance for all classes in real time.</li>
        <li>Export compliance-ready reports for management and audits.</li>
        <li>Control who can view or edit attendance and reports.</li>
      </ul>
    </section>

    <!-- Main dashboard grid -->
    <section class="admin-grid">
      <!-- Summary stats -->
      <section class="card glass admin-stats">
        <div class="stat-card">
          <div class="stat-icon stat-icon-blue">ğŸ‘¨â€ğŸ“</div>
          <div class="stat-content">
            <div class="stat-value" id="statTotalStudents">640</div>
            <div class="stat-label">Total Students</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon stat-icon-green">ğŸ‘©â€ğŸ«</div>
          <div class="stat-content">
            <div class="stat-value" id="statTotalTeachers">12</div>
            <div class="stat-label">Total Teachers</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon stat-icon-purple">ğŸ«</div>
          <div class="stat-content">
            <div class="stat-value" id="statTotalClasses">24</div>
            <div class="stat-label">Total Classes</div>
          </div>
        </div>
        <div class="stat-card">
          <div class="stat-icon stat-icon-pink">ğŸ›¡ï¸</div>
          <div class="stat-content">
            <div class="stat-value" id="statActivePolicies">6</div>
            <div class="stat-label">Active Policies</div>
          </div>
        </div>
      </section>

      <!-- Quick actions -->
      <section class="card glass admin-quick-actions">
        <h3 class="section-title">Quick Actions</h3>
        <p class="section-subtitle">Create records with a single click.</p>
        <div class="quick-actions-grid">
          <button type="button" class="btn-pill" onclick="window.location.href='class-management.html'">
            <span class="btn-pill-icon">ğŸ«</span>
            <span>Add Class</span>
          </button>
          <button type="button" class="btn-pill" onclick="window.location.href='teachers.html'">
            <span class="btn-pill-icon">ğŸ‘©â€ğŸ«</span>
            <span>Add Teacher</span>
          </button>
          <button type="button" class="btn-pill" onclick="window.location.href='students.html'">
            <span class="btn-pill-icon">ğŸ‘¨â€ğŸ“</span>
            <span>Add Student</span>
          </button>
        </div>
      </section>

      <!-- Recent activity -->
      <section class="card glass admin-activity">
        <h3 class="section-title">Recent Admin Activity</h3>
        <p class="section-subtitle">Latest configuration changes and management actions.</p>
        <ul class="activity-list">
          <li class="activity-item">
            <span class="activity-icon">â•</span>
            <div class="activity-content">
              <p class="activity-text">Admin added new class <strong>10-A</strong> and assigned a teacher.</p>
              <span class="activity-meta">2 minutes ago</span>
            </div>
          </li>
          <li class="activity-item">
            <span class="activity-icon">ğŸ‘¤</span>
            <div class="activity-content">
              <p class="activity-text">Admin created teacher account <strong>Priya Sharma</strong>.</p>
              <span class="activity-meta">15 minutes ago</span>
            </div>
          </li>
          <li class="activity-item">
            <span class="activity-icon">ğŸ“</span>
            <div class="activity-content">
              <p class="activity-text">Admin updated student profile information.</p>
              <span class="activity-meta">30 minutes ago</span>
            </div>
          </li>
          <li class="activity-item">
            <span class="activity-icon">ğŸ“‘</span>
            <div class="activity-content">
              <p class="activity-text">Admin generated a system-wide usage report.</p>
              <span class="activity-meta">Today, 10:15 AM</span>
            </div>
          </li>
        </ul>
      </section>
    </section>
  </main>

  <script>

    async function loadAdminStats() {
      try {
        const res = await authFetch('/api/dashboard/admin');
        const data = await res.json();
        const studentsEl = document.getElementById('statTotalStudents');
        const teachersEl = document.getElementById('statTotalTeachers');
        const classesEl = document.getElementById('statTotalClasses');
        const policiesEl = document.getElementById('statActivePolicies');

        if (studentsEl) studentsEl.textContent = data.total_students != null ? data.total_students : '0';
        if (teachersEl) teachersEl.textContent = data.total_teachers != null ? data.total_teachers : '0';
        if (classesEl) classesEl.textContent = data.total_classes != null ? data.total_classes : '0';
        if (policiesEl) policiesEl.textContent = data.active_policies != null ? data.active_policies : '0';
      } catch (err) {
        console.error('Failed to load admin stats:', err);
      }
    }

    (function enforceAdmin() {
      const auth = getAuth();
      const p = document.getElementById('adminWelcome');
      if (!auth || !auth.user || !auth.token) {
        if (p) p.textContent = 'Not logged in. Redirecting to login...';
        setTimeout(() => (window.location.href = 'index.html'), 600);
        return;
      }

      const role = auth.user.role;
      // Only admins can see this dashboard and its menu items.
      if (role !== 'admin') {
        if (role === 'teacher') {
          window.location.href = 'teacher-dashboard.html';
        } else if (role === 'student') {
          window.location.href = 'student-dashboard.html';
        } else {
          window.location.href = 'index.html';
        }
        return;
      }

      if (p) p.textContent = `Welcome, ${auth.user.username} (Admin)`;

      loadAdminStats();
    })();

    document.getElementById('adminLogout').addEventListener('click', () => {
      logout(); // Uses shared logout function from auth.js
    });
  </script>
</body>
</html>
